<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>B√°o c√°o Qu·∫£n tr·ªã ‚Äî DATANA</title>
    <link rel="icon" type="image/jpg" href="../images/logo.jpg">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="../css/main.css" />
    
    <style>
        /* CSS Layout ri√™ng cho Dashboard */
        .dashboard-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 25px; flex-wrap: wrap; gap: 15px;
        }
        .kpi-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }
        .charts-grid {
            display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px;
        }
        .charts-grid.half { grid-template-columns: 1fr 1fr; }
        .chart-container { position: relative; height: 300px; width: 100%; }
        
        /* Tabs */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        .tab-btn {
            background: transparent; border: none; color: #94a3b8; padding: 8px 16px;
            cursor: pointer; font-weight: 600; border-radius: 6px; transition: 0.2s;
        }
        .tab-btn:hover, .tab-btn.active { background: rgba(99, 102, 241, 0.1); color: #818cf8; }
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        
        /* Responsive */
        @media (max-width: 1000px) { .charts-grid, .charts-grid.half { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="container">
            <a href="../index.html" class="brand" style="text-decoration: none; display: flex; align-items: center; gap: 10px;">
                <img src="../images/logo.svg" alt="DATANA" style="height: 32px;" onerror="this.style.display='none'"> 
                <span>DATANA</span>
            </a>
            <nav>
                <a href="../index.html" class="nav-link"><i class="fas fa-home"></i> <span>Trang ch·ªß</span></a>
                <a href="upload.html" class="nav-link"><i class="fas fa-cloud-upload-alt"></i> <span>T·∫£i l√™n</span></a>
                <a href="dashboard.html" class="nav-link active" style="color:#6366f1;"><i class="fas fa-chart-pie"></i> <span>B√°o c√°o</span></a>
                <a href="chat.html" class="nav-link"><i class="fas fa-robot"></i> <span>AI Chat</span></a>
            </nav>
            <div id="userSection">
                <a href="login.html" style="color:#94a3b8; text-decoration:none; font-size:0.9rem;">ƒêƒÉng nh·∫≠p</a>
            </div>
        </div>
    </header>

    <div class="app-wrapper">
        <div class="main-content" style="overflow-y: auto;">
            <div class="container" style="padding-top: 30px; padding-bottom: 50px;">
                
                <div class="dashboard-header">
                    <div>
                        <h2 style="margin:0; color:white; font-size: 1.8rem;">T·ªïng quan Kinh doanh</h2>
                        <p style="margin:5px 0 0; color:#94a3b8;">D·ªØ li·ªáu ƒë∆∞·ª£c c·∫≠p nh·∫≠t t·ª´ file Excel c·ªßa b·∫°n</p>
                    </div>
                    <div class="controls" style="display:flex; gap:10px;">
                        <button id="printPreviewBtn" class="btn-secondary" style="background:#fff; color:#0f172a; border:none; padding:10px 18px; border-radius:8px; cursor:pointer; font-weight:600; display:flex; align-items:center; gap:8px;">
                            <i class="fas fa-file-pdf" style="color:#ef4444;"></i> Xu·∫•t B√°o C√°o
                        </button>
                        <a href="upload.html" class="btn-primary" style="text-decoration:none; background:#6366f1; color:white; padding:10px 18px; border-radius:8px; font-weight:600; display:flex; align-items:center; gap:8px;">
                            <i class="fas fa-upload"></i> T·∫£i file m·ªõi
                        </a>
                    </div>
                </div>

                <div class="kpi-grid">
                    <div class="card">
                        <div class="stat-label"><i class="fas fa-wallet" style="color:#34d399; margin-right:5px;"></i> T·ªîNG DOANH THU</div>
                        <div class="stat-value" id="kpi_rev">0 ‚Ç´</div>
                        <div style="font-size:0.85rem; color:#34d399;">D√≤ng ti·ªÅn th·ª±c t·∫ø</div>
                    </div>
                    <div class="card">
                        <div class="stat-label"><i class="fas fa-coins" style="color:#f472b6; margin-right:5px;"></i> L·ª¢I NHU·∫¨N R√íNG</div>
                        <div class="stat-value" id="kpi_profit">0 ‚Ç´</div>
                        <div style="font-size:0.85rem; color:#f472b6;">Hi·ªáu qu·∫£ kinh doanh</div>
                    </div>
                    <div class="card">
                        <div class="stat-label"><i class="fas fa-crown" style="color:#f59e0b; margin-right:5px;"></i> S·∫¢N PH·∫®M TOP 1</div>
                        <div class="stat-value" id="kpi_topprod" style="font-size:1.4rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">-</div>
                        <div style="font-size:0.85rem; color:#f59e0b;">B√°n ch·∫°y nh·∫•t k·ª≥ n√†y</div>
                    </div>
                </div>

                <div class="ai-box">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h3 style="margin:0; color:#fff; display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-brain" style="color:#a855f7;"></i> Ph√¢n t√≠ch & D·ª± b√°o Chi·∫øn l∆∞·ª£c (AI)
                        </h3>
                        <button id="btnAiForecast" style="background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); color:#fff; padding:6px 12px; border-radius:6px; cursor:pointer; font-size:0.9rem;">
                            ‚ú® Ph√¢n t√≠ch ngay
                        </button>
                    </div>
                    <div id="aiForecastResult" style="color:#e2e8f0; line-height:1.6; font-size:0.95rem;">
                        <p style="color:#94a3b8; font-style:italic;">B·∫•m n√∫t tr√™n ƒë·ªÉ AI ƒë·ªçc d·ªØ li·ªáu v√† ƒë∆∞a ra nh·∫≠n ƒë·ªãnh th·ªã tr∆∞·ªùng...</p>
                    </div>
                </div>

                <div class="tabs">
                    <button class="tab-btn active" data-tab="tab-overview"><i class="fas fa-chart-line"></i> Bi·ªÉu ƒë·ªì T·ªïng quan</button>
                    <button class="tab-btn" data-tab="tab-details"><i class="fas fa-table"></i> Chi ti·∫øt S·ªë li·ªáu</button>
                </div>

                <div id="tab-overview" class="tab-content active">
                    <div class="charts-grid">
                        <div class="card">
                            <h3 style="color:#fff; font-size:1rem; margin-bottom:15px;">Xu h∆∞·ªõng Doanh thu & D·ª± b√°o</h3>
                            <div class="chart-container"><canvas id="chartLine"></canvas></div>
                        </div>
                        <div class="card">
                            <h3 style="color:#fff; font-size:1rem; margin-bottom:15px;">T·ª∑ tr·ªçng S·∫£n ph·∫©m</h3>
                            <div class="chart-container" style="height:250px;"><canvas id="chartDonut"></canvas></div>
                        </div>
                    </div>
                    <div class="charts-grid half">
                        <div class="card">
                            <h3 style="color:#fff; font-size:1rem; margin-bottom:15px;">Doanh thu theo V√πng</h3>
                            <div class="chart-container"><canvas id="chartBar"></canvas></div>
                        </div>
                        <div class="card">
                            <h3 style="color:#fff; font-size:1rem; margin-bottom:15px;">Top 5 L·ª£i nhu·∫≠n</h3>
                            <div class="chart-container"><canvas id="chartProfitBar"></canvas></div>
                        </div>
                    </div>
                    <div class="charts-grid half">
                        <div class="card">
                            <h3 style="color:#fff; font-size:1rem; margin-bottom:5px;"><i class="fas fa-soap" style="color:#a7f3d0;"></i> Hi·ªáu su·∫•t Th∆∞∆°ng hi·ªáu</h3>
                            <p style="color:#64748b; font-size:0.8rem; margin-bottom:15px;">(X: Doanh thu, Y: L·ª£i nhu·∫≠n, B√≥ng: S·ªë l∆∞·ª£ng)</p>
                            <div class="chart-container" style="height: 320px;"><canvas id="chartBrandBubble"></canvas></div>
                        </div>
                        <div class="card">
                            <h3 style="color:#fff; font-size:1rem; margin-bottom:5px;"><i class="fas fa-chart-area" style="color:#f472b6;"></i> Xu h∆∞·ªõng K√©p</h3>
                            <p style="color:#64748b; font-size:0.8rem; margin-bottom:15px;">(C·ªôt: Doanh thu - Tr√°i | ƒê∆∞·ªùng: L·ª£i nhu·∫≠n - Ph·∫£i)</p>
                            <div class="chart-container" style="height: 320px;"><canvas id="chartRevProfitDual"></canvas></div>
                        </div>
                    </div>
                </div>

                <div id="tab-details" class="tab-content">
                    
                    <div class="card table-card" style="margin-bottom:20px;">
                        <h3 style="color:#fff; margin-bottom:15px;">üî• Top S·∫£n ph·∫©m B√°n ch·∫°y</h3>
                        <div style="overflow-x:auto;">
                            <table class="datana-table">
                                <thead><tr><th>S·∫£n ph·∫©m</th><th style="text-align:center;">S·ªë l∆∞·ª£ng</th><th style="text-align:right;">Gi√° TB</th><th style="text-align:right;">L·ª£i nhu·∫≠n</th></tr></thead>
                                <tbody id="tbl_bestseller"></tbody>
                            </table>
                        </div>
                    </div>

                    <div class="charts-grid half">
                        <div class="card table-card">
                            <h3 style="color:#fff; margin-bottom:15px;">Th·ªëng k√™ Th∆∞∆°ng hi·ªáu</h3>
                            <div style="max-height: 400px; overflow-y: auto;">
                                <table class="datana-table"><thead><tr><th>Th∆∞∆°ng hi·ªáu</th><th style="text-align:right;">Doanh thu</th><th style="text-align:right;">L·ª£i nhu·∫≠n</th></tr></thead><tbody id="tbl_brand"></tbody></table>
                            </div>
                        </div>
                        <div class="card table-card">
                            <h3 style="color:#fff; margin-bottom:15px;">Th·ªëng k√™ Ng√†nh h√†ng</h3>
                             <div style="max-height: 400px; overflow-y: auto;">
                                <table class="datana-table"><thead><tr><th>Ng√†nh h√†ng</th><th style="text-align:center;">SL</th><th style="text-align:right;">Doanh thu</th></tr></thead><tbody id="tbl_category"></tbody></table>
                            </div>
                        </div>
                    </div>

                    <div class="card table-card" style="margin-top: 20px;">
                        <h3 style="color:#fff; margin-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
                            <span>üìä B√°o c√°o Hi·ªáu qu·∫£ Chi ti·∫øt</span>
                            <span style="font-size:0.8rem; font-weight:normal; opacity:0.8;">(T·ª± ƒë·ªông t√≠nh Bi√™n l·ª£i nhu·∫≠n)</span>
                        </h3>
                        <div style="overflow-x:auto;">
                            <table class="datana-table">
                                <thead>
                                    <tr>
                                        <th style="width: 30%;">T√™n S·∫£n ph·∫©m</th>
                                        <th style="width: 15%;">Danh m·ª•c</th>
                                        <th style="text-align:center;">ƒê√£ b√°n</th>
                                        <th style="text-align:right;">Doanh thu</th>
                                        <th style="text-align:right;">L·ª£i nhu·∫≠n</th>
                                        <th style="text-align:center;">Bi√™n LN (%)</th>
                                    </tr>
                                </thead>
                                <tbody id="tbl_full_products"></tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card table-card" style="margin-top: 20px;">
                        <h3 style="color:#fff; margin-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
                            <span>üìÖ B√°o c√°o TƒÉng tr∆∞·ªüng theo Th√°ng</span>
                            <span style="font-size:0.8rem; font-weight:normal; opacity:0.8;">(So s√°nh v·ªõi th√°ng tr∆∞·ªõc ƒë√≥)</span>
                        </h3>
                        <div style="overflow-x:auto;">
                            <table class="datana-table">
                                <thead>
                                    <tr>
                                        <th style="width: 25%;">Th√°ng</th>
                                        <th style="text-align:right;">Doanh thu</th>
                                        <th style="text-align:right;">L·ª£i nhu·∫≠n</th>
                                        <th style="text-align:center;">S·ªë l∆∞·ª£ng</th>
                                        <th style="text-align:center;">TƒÉng tr∆∞·ªüng (MoM)</th>
                                    </tr>
                                </thead>
                                <tbody id="tbl_monthly_growth"></tbody>
                            </table>
                        </div>
                    </div>

                    <div style="display:none;">
                        <tbody id="tbl_profit_product"></tbody><tbody id="tbl_avg"></tbody><tbody id="tbl_price_range"></tbody><tbody id="tbl_region"></tbody><canvas id="chartCategoryBar"></canvas>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div id="loadingOverlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(15,23,42,0.95); z-index:9999; display:none; flex-direction:column; align-items:center; justify-content:center;">
        <div style="width:50px; height:50px; border:4px solid rgba(255,255,255,0.1); border-top:4px solid #6366f1; border-radius:50%; animation:spin 1s linear infinite;"></div>
        <p class="loading-text" style="color:white; margin-top:15px;">ƒêang x·ª≠ l√Ω d·ªØ li·ªáu...</p>
    </div>
    <style>@keyframes spin { 100% { transform: rotate(360deg); } }</style>

    <div id="printCover" style="display:none;">
        <div style="text-align:center; padding-top:20vh;">
            <img src="../images/logo.jpg" alt="DATANA" style="width:180px; height:auto; margin-bottom:30px; border-radius:12px;" onerror="this.style.display='none'">
            
            <h1 style="font-size:3.5rem; color:#fff; margin-bottom:10px; font-weight:800;">B√ÅO C√ÅO QU·∫¢N TR·ªä</h1>
            <h2 id="printTitleDisplay" style="font-size:1.8rem; color:#fff; font-weight:900; margin-bottom:100px;">T·ªîNG QUAN & CHI·∫æN L∆Ø·ª¢C KINH DOANH</h2>
            <div style="color:#94a3b8; font-size:1.2rem;">
                <p id="printDateDisplay">Ng√†y xu·∫•t b·∫£n: ...</p>
                <p>Th·ª±c hi·ªán b·ªüi: H·ªá th·ªëng AI Datana</p>
            </div>
        </div>
    </div>

    <input type="hidden" id="reportTitleInput" value="B√ÅO C√ÅO T·ªîNG H·ª¢P">
    <script src="../js/dashboard.js"></script>
    <script>
        const u = localStorage.getItem('datana_user');
        if(u) {
            document.getElementById('userSection').innerHTML = `<div style="display:flex; align-items:center; gap:10px; cursor:pointer;" onclick="if(confirm('ƒêƒÉng xu·∫•t?')){localStorage.removeItem('datana_user');location.reload();}"><div style="width:32px; height:32px; background:#475569; color:#fff; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold;">${u.charAt(0).toUpperCase()}</div><span style="color:white; font-size:0.9rem;">${u}</span></div>`;
        }
    </script>
</body>
</html>