<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DATANA - B√°o c√°o Doanh s·ªë</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../css/main.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <!-- Aurora Background Gradient -->
  <div class="aurora"></div>

  <!-- Sidebar Navigation -->
  <aside class="sidebar">
    <a class="brand" href="../index.html">
      <i class="fas fa-meteor"></i>
      <span>DATANA</span>
    </a>
    
    <ul class="nav-links">
      <li><a class="nav-link" href="../index.html"><i class="fas fa-home"></i> Trang ch·ªß</a></li>
      <li><a class="nav-link" href="upload.html"><i class="fas fa-cloud-upload"></i> T·∫£i l√™n</a></li>
      <li><a class="nav-link active" href="dashboard.html"><i class="fas fa-chart-line"></i> B√°o c√°o</a></li>
      <li><a class="nav-link" href="chat.html"><i class="fas fa-brain"></i> Tr·ª£ l√Ω AI</a></li>
      <li><a class="nav-link" href="../pages/about.html"><i class="fas fa-info-circle"></i> Gi·ªõi thi·ªáu</a></li>
    </ul>
    
    <!-- User Profile Card -->
    <div class="user-pill" id="userSection">
      <span id="userDisplay"><i class="fas fa-user-circle"></i> Kh√°ch</span>
      <button class="pill-btn logout-btn" id="logoutBtn" style="display:none; transition: all 0.3s ease;" title="ƒêƒÉng xu·∫•t">
        <i class="fas fa-sign-out-alt"></i>
      </button>
      <button class="pill-btn" id="loginBtn" onclick="location.href='login.html'">ƒêƒÉng nh·∫≠p</button>
    </div>
  </aside>

  <!-- Main Content Area -->
  <main class="main-content">
    
    <!-- Header with Title and Actions -->
    <div class="header-actions">
      <div class="page-title">
        <h1>T·ªïng Quan Kinh Doanh</h1>
        <p>Ph√¢n t√≠ch d·ªØ li·ªáu b√°n h√†ng real-time v·ªõi AI</p>
      </div>
      <div class="action-group">
        <button class="btn" id="refreshBtn" title="L√†m m·ªõi d·ªØ li·ªáu">
          <i class="fas fa-rotate-right"></i> L√†m m·ªõi
        </button>
        <button class="btn neon" id="printBtn" title="Xu·∫•t b√°o c√°o PDF">
          <i class="fas fa-file-pdf"></i> Xu·∫•t PDF
        </button>
      </div>
    </div>

    <!-- Filter Bar -->
    <section class="filter-bar">
      <div class="filter-group">
        <label for="startDate">T·ª´ ng√†y</label>
        <input type="date" id="startDate">
      </div>
      <div class="filter-group">
        <label for="endDate">ƒê·∫øn ng√†y</label>
        <input type="date" id="endDate">
      </div>
      <div class="filter-group">
        <label>Danh m·ª•c</label>
        <div class="custom-dropdown" id="categoryDropdown">
          <button class="dropdown-toggle" onclick="toggleDropdown('categoryDropdown')">
            <i class="fas fa-list"></i> Ch·ªçn danh m·ª•c
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="dropdown-menu" id="categoryMenu" style="display: none;"></div>
        </div>
      </div>
      <div class="filter-group">
        <label>Th∆∞∆°ng hi·ªáu</label>
        <div class="custom-dropdown" id="brandDropdown">
          <button class="dropdown-toggle" onclick="toggleDropdown('brandDropdown')">
            <i class="fas fa-building"></i> Ch·ªçn th∆∞∆°ng hi·ªáu
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="dropdown-menu" id="brandMenu" style="display: none;"></div>
        </div>
      </div>
      <button class="btn neon" id="applyFilter">
        <i class="fas fa-filter"></i> L·ªçc
      </button>
    </section>

    <!-- KPI Cards -->
    <section class="kpis">
      <div class="kpi-card">
        <div class="kpi-label">üí∞ Doanh Thu</div>
        <div class="kpi-value" id="kpi_rev">$0</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-label">üìà L·ª£i Nhu·∫≠n</div>
        <div class="kpi-value" id="kpi_profit">$0</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-label">üì¶ T·ªïng S·ªë L∆∞·ª£ng</div>
        <div class="kpi-value" id="kpi_qty">0</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-label">‚≠ê Top S·∫£n Ph·∫©m</div>
        <div class="kpi-value" id="kpi_top" style="font-size: 1.1rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">-</div>
      </div>
    </section>

    <!-- Charts Grid (single-column now) -->
    <section class="charts-grid">
      
      <!-- Top 10 Revenue (Bar Chart) -->
      <div class="chart-card" id="cardTopRev">
        <div class="chart-header">
          <span>üìä Top 10 Doanh Thu</span>
        </div>
        <div class="chart-canvas">
          <canvas id="chartTopRev"></canvas>
        </div>
      </div>

      <!-- Brand Market Share (Horizontal Bar Chart) -->
      <div class="chart-card" id="cardBrand">
        <div class="chart-header">
          <span>üè¢ Th·ªã Ph·∫ßn Th∆∞∆°ng Hi·ªáu</span>
        </div>
        <div class="chart-canvas">
          <canvas id="chartBrand"></canvas>
        </div>
      </div>

      <!-- Revenue Trend (Line Chart - Full Width) -->
      <div class="chart-card" id="cardTrend" style="grid-column: 1 / -1;">
        <div class="chart-header">
          <span>üìà Xu H∆∞·ªõng Doanh Thu Theo Th·ªùi Gian</span>
        </div>
        <div class="chart-canvas">
          <canvas id="chartTrend"></canvas>
        </div>
      </div>

      <!-- Category Distribution (Doughnut Chart) -->
      <div class="chart-card" id="cardCat">
        <div class="chart-header">
          <span>üìÇ Ph√¢n B·ªë Danh M·ª•c</span>
        </div>
        <div class="chart-canvas">
          <canvas id="chartCat"></canvas>
        </div>
      </div>

      <!-- Price vs Quantity (Bubble Chart) -->
      <div class="chart-card" id="cardScatter">
        <div class="chart-header">
          <span>üí¨ Gi√° vs S·ªë L∆∞·ª£ng (Bubble)</span>
        </div>
        <div class="chart-canvas">
          <canvas id="chartScatter"></canvas>
        </div>
      </div>

      <!-- Top 10 Profit (Bar Chart) -->
      <div class="chart-card" id="cardTopProfit">
        <div class="chart-header">
          <span>üíé Top 10 L·ª£i Nhu·∫≠n</span>
        </div>
        <div class="chart-canvas">
          <canvas id="chartTopProfit"></canvas>
        </div>
      </div>

    </section>

    <!-- Data Table -->
    <section class="table-card">
      <div class="chart-header">
        <span>üìã Top 20 S·∫£n Ph·∫©m B√°n Ch·∫°y</span>
      </div>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>S·∫£n Ph·∫©m</th>
              <th>Th∆∞∆°ng Hi·ªáu</th>
              <th>Danh M·ª•c</th>
              <th>Gi√° ƒê∆°n V·ªã</th>
              <th>S·ªë L∆∞·ª£ng</th>
              <th>Doanh Thu</th>
              <th>L·ª£i Nhu·∫≠n</th>
            </tr>
          </thead>
          <tbody id="dataTableBody">
            <tr>
              <td colspan="7" style="text-align: center; color: var(--text-muted);">Ch∆∞a c√≥ d·ªØ li·ªáu...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- AI Advisory Section -->
    <section class="ai-card">
      <div class="ai-header">
        <div>
          <span class="eyebrow">ü§ñ AI CFO Advisor</span>
          <h3>Chi·∫øn L∆∞·ª£c Kinh Doanh Th√¥ng Minh</h3>
        </div>
        <button id="btnAiForecast" class="btn neon">
          <i class="fas fa-robot"></i> Ph√¢n T√≠ch v·ªõi AI
        </button>
      </div>
      <div id="aiForecastResult" class="ai-result">
        B·∫•m n√∫t "Ph√¢n T√≠ch v·ªõi AI" ƒë·ªÉ nh·∫≠n khuy·∫øn ngh·ªã t·ª´ AI d·ª±a tr√™n d·ªØ li·ªáu kinh doanh c·ªßa b·∫°n.
      </div>
    </section>

  </main>

  <!-- Page Loading Spinner -->
  <div id="pageSpinner" class="page-spinner hidden">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu dashboard...</p>
  </div>

  <!-- Scripts -->
  <script src="../js/dashboard.js"></script>
  <script>
    // Bind User Section
    const userEl = document.getElementById('userSection');
    const user = localStorage.getItem('datana_user');
    
    if (userEl) {
      if (user) {
        userEl.innerHTML = `
          <span><i class="fas fa-user-circle"></i> ${user}</span>
          <button class="pill-btn logout-btn" id="logoutBtn" title="ƒêƒÉng xu·∫•t">
            <i class="fas fa-sign-out-alt"></i>
          </button>
        `;
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
          logoutBtn.onclick = async (e) => {
            e.preventDefault();
            if (confirm('B·∫°n ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t?')) {
              try {
                await fetch('/api/logout', { method: 'POST' });
              } catch (err) {
                console.error('Logout error:', err);
              }
              localStorage.clear();
              location.href = '../index.html';
            }
          };
        }
      } else {
        userEl.innerHTML = `
          <span><i class="fas fa-user-circle"></i> Kh√°ch</span>
          <button class="pill-btn" id="loginBtn" onclick="location.href='login.html'">ƒêƒÉng nh·∫≠p</button>
        `;
      }
    }
  </script>
</body>
</html>