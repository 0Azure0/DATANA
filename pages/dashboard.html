<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>BÃ¡o cÃ¡o â€” DATANA</title>
  
  <link rel="stylesheet" href="../css/main.css">
  <link rel="stylesheet" href="../css/dashboard.css">
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="../js/charts.js" defer></script>
  <script src="../js/dashboard.js" defer></script>
</head>
<body>
  <header class="site-header">
    <div class="container">
      <a href="../index.html" class="brand" style="text-decoration: none;">DATANA</a>
      <nav>
        <ul>
          <li><a href="../index.html" class="nav-link">Trang chá»§</a></li>
          <li><a href="upload.html" class="nav-link">Táº£i lÃªn</a></li>
          <li><a href="dashboard.html" class="nav-link active" style="color: var(--text-main);">BÃ¡o cÃ¡o</a></li>
          <li><a href="chat.html" class="nav-link">Trá»£ lÃ½ AI</a></li>
          <li><a href="about.html" class="nav-link">Giá»›i thiá»‡u</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container dashboard-container">
    <div class="dashboard-header">
        <h1>ğŸ“Š BÃ¡o cÃ¡o hiá»‡u quáº£ kinh doanh</h1>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab(event, 'tab-overview')">Tá»•ng quan & Xu hÆ°á»›ng</button>
            <button class="tab-btn" onclick="openTab(event, 'tab-region')">Khu vá»±c & So sÃ¡nh</button>
            <button class="tab-btn" onclick="openTab(event, 'tab-product')">Sáº£n pháº©m & Tá»· trá»ng</button>
            <button class="tab-btn" onclick="openTab(event, 'tab-data')">Dá»¯ liá»‡u chi tiáº¿t</button>
        </div>
    </div>
    
    <section class="kpis">
      <div class="kpi highlight">
        <h4 id="kpi_rev">-</h4>
        <p>Tá»•ng doanh thu</p>
      </div>
      <div class="kpi highlight">
        <h4 id="kpi_profit">-</h4>
        <p>Tá»•ng lá»£i nhuáº­n</p>
      </div>
      <div class="kpi highlight">
        <h4 id="kpi_topprod">-</h4>
        <p>Top sáº£n pháº©m</p>
      </div>
    </section>

    <div id="tab-overview" class="tab-content active">
        <div class="charts-grid">
            <div class="chart-card"><h5>ğŸ“ˆ Xu hÆ°á»›ng doanh thu (Line)</h5><div class="chart-canvas"><canvas id="chartLine"></canvas></div></div>
            <div class="chart-card"><h5>ğŸ“ˆ TÄƒng trÆ°á»Ÿng tÃ­ch lÅ©y (Area)</h5><div class="chart-canvas"><canvas id="chartArea"></canvas></div></div>
        </div>
    </div>

    <div id="tab-region" class="tab-content">
        <div class="charts-grid">
            <div class="chart-card"><h5>ğŸ“Š Doanh thu theo khu vá»±c (Bar)</h5><div class="chart-canvas"><canvas id="chartBar"></canvas></div></div>
            <div class="chart-card"><h5>ğŸ”¥ Top sáº£n pháº©m theo vÃ¹ng (Stacked)</h5><div class="chart-canvas"><canvas id="chartStack"></canvas></div></div>
        </div>
    </div>

    <div id="tab-product" class="tab-content">
        <div class="charts-grid three-cols">
            <div class="chart-card"><h5>ğŸ° Tá»· trá»ng doanh thu (Donut)</h5><div class="chart-canvas"><canvas id="chartDonut"></canvas></div></div>
            <div class="chart-card"><h5>ğŸ¯ Hiá»‡u suáº¥t sáº£n pháº©m (Radar)</h5><div class="chart-canvas"><canvas id="chartRadar"></canvas></div></div>
            <div class="chart-card"><h5>ğŸ’« GiÃ¡ & Sá»‘ lÆ°á»£ng (Scatter)</h5><div class="chart-canvas"><canvas id="chartScatter"></canvas></div></div>
        </div>
    </div>

    <div id="tab-data" class="tab-content">
        <section class="data-table-wrapper">
            <div id="tableWrap"></div>
        </section>
    </div>

  </main>

  <script>
    // Logic chuyá»ƒn Tab Ä‘Æ¡n giáº£n
    function openTab(evt, tabName) {
        var i, tabcontent, tablinks;
        
        // 1. áº¨n táº¥t cáº£ ná»™i dung tab
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
            tabcontent[i].classList.remove("active");
        }
        
        // 2. Bá» class active á»Ÿ táº¥t cáº£ nÃºt
        tablinks = document.getElementsByClassName("tab-btn");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].classList.remove("active");
        }
        
        // 3. Hiá»‡n tab Ä‘Æ°á»£c chá»n
        document.getElementById(tabName).style.display = "block";
        // setTimeout Ä‘á»ƒ fix lá»—i chart.js khÃ´ng váº½ Ä‘Æ°á»£c khi display:none
        setTimeout(() => {
             document.getElementById(tabName).classList.add("active");
             // Trigger resize event Ä‘á»ƒ chart váº½ láº¡i cho Ä‘Ãºng kÃ­ch thÆ°á»›c
             window.dispatchEvent(new Event('resize'));
        }, 50);
       
        evt.currentTarget.classList.add("active");
    }

    // Login logic (giá»¯ nguyÃªn)
    async function checkLogin() {
        try {
            const res = await fetch('/api/user_info');
            const data = await res.json();
            const navUl = document.querySelector('nav ul');
            if (data.logged_in) {
                const li = document.createElement('li');
                li.innerHTML = `<a href="#" onclick="logout()" class="nav-link" style="color: #ef4444;">ÄÄƒng xuáº¥t (${data.username})</a>`;
                navUl.appendChild(li);
            } else {
                const li = document.createElement('li');
                li.innerHTML = `<a href="login.html" class="btn-primary" style="padding: 8px 16px;">ÄÄƒng nháº­p</a>`;
                navUl.appendChild(li);
            }
        } catch(e) {}
    }
    async function logout() {
        await fetch('/api/logout');
        localStorage.removeItem('datana_user');
        window.location.reload();
    }
    checkLogin();
  </script>
</body>
</html>